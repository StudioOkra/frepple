{% extends "admin/base_site_grid.html" %}
{% load i18n %}

{% block extrahead %}{{block.super}}
<script src="{{STATIC_URL}}js/dhtmlxgantt.js"></script>
<link rel="stylesheet" href="{{STATIC_URL}}css/dhtmlxgantt.css" type="text/css">
<style>
.gantt_task_line.milestone{
    background-color: #f0f0f0;
    border: 0 solid #ddd;
    border-radius: 0;
    height: 25px;
    margin-top: 0;
}
</style>
{% endblock %}

{% block content %}
<div id="scheduler_gantt" style='width:100%; height:100%;'></div>
<script>
gantt.config.xml_date = "%Y-%m-%d %H:%i:%s";
gantt.init("scheduler_gantt");

// Add drag & drop support
gantt.config.drag_links = true;
gantt.config.drag_progress = true;
gantt.config.drag_resize = true;
gantt.config.drag_move = true;

// Load data
gantt.load("{% url 'scheduler:gantt_data' %}");

// Handle updates
gantt.attachEvent("onAfterTaskUpdate", function(id,item){
    $.ajax({
        url: "{% url 'scheduler:update_task' %}",
        type: "POST",
        data: {
            id: id,
            start_date: item.start_date,
            end_date: item.end_date,
            progress: item.progress
        },
        success: function(response){
            gantt.message({text:"Updated", type:"success"});
        }
    });
});
</script>
{% endblock %}
